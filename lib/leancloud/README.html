<h1 id="hexo-leancloud-counter-security"><a href="#hexo-leancloud-counter-security" class="headerlink" title="hexo-leancloud-counter-security"></a>hexo-leancloud-counter-security</h1><p><a href="https://travis-ci.org/theme-next/hexo-leancloud-counter-security?branch=master"><img src="https://travis-ci.org/theme-next/hexo-leancloud-counter-security.svg?branch=master" alt="travis-image"></a><br><a href="https://hexo.io"><img src="https://img.shields.io/badge/hexo-%3E%3D%203.0-blue.svg" alt="hexo-image"></a><br><a href="https://nodejs.org/en/download/releases"><img src="https://img.shields.io/node/v/hexo-leancloud-counter-security.svg" alt="node-image"></a><br><a href="https://www.npmjs.com/package/hexo-leancloud-counter-security"><img src="https://badge.fury.io/js/hexo-leancloud-counter-security.svg" alt="npm-image"></a><br><a href="../../commits/master"><img src="https://img.shields.io/maintenance/yes/2018.svg" alt="mnt-image"></a><br><a href="LICENSE"><img src="https://img.shields.io/npm/l/hexo-leancloud-counter-security.svg" alt="lic-image"></a></p>
<p>A plugin to fix a serious security bug in leancloud visitor counter for NexT theme site and other site that integrated this function using a similar way.</p>
<p>Documentation how to set the counter up and running safely aviable in <a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/LEANCLOUD-COUNTER-SECURITY.md">English</a> or <a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md">Chinese</a> languages.</p>
<p>And you can also read full explanation of current problem <a href="https://leaferx.online/2018/02/11/lc-security/">here</a>.</p>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p><img src="https://img.shields.io/github/size/theme-next/hexo-leancloud-counter-security/index.js.svg" alt="size-image"><br><a href="https://www.npmjs.com/package/hexo-leancloud-counter-security"><img src="https://img.shields.io/npm/dm/hexo-leancloud-counter-security.svg" alt="dm-image"></a><br><a href="https://www.npmjs.com/package/hexo-leancloud-counter-security"><img src="https://img.shields.io/npm/dt/hexo-leancloud-counter-security.svg" alt="dt-image"></a></p>
<pre><code class="bash">npm install hexo-leancloud-counter-security --save</code></pre>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Activate this plugin in hexo’s <code>_config.yml</code> (which locates in the root dir of your blog) by filling those options:</p>
<pre><code class="yml"><span class="attr">leancloud_counter_security:</span>
<span class="attr">  enable_sync:</span> <span class="literal">true</span>
<span class="attr">  app_id:</span> <span class="string">&lt;&lt;your</span> <span class="string">app</span> <span class="string">id&gt;&gt;</span>
<span class="attr">  app_key:</span> <span class="string">&lt;&lt;your</span> <span class="string">app</span> <span class="string">key&gt;&gt;</span>
<span class="attr">  username:</span> <span class="string">&lt;&lt;your</span> <span class="string">username&gt;&gt;</span> <span class="comment"># Will be asked while deploying if is left blank</span>
<span class="attr">  password:</span> <span class="string">&lt;&lt;your</span> <span class="string">password&gt;&gt;</span> <span class="comment"># Recommmended to be left blank. Will be asked while deploying if is left blank</span></code></pre>
<p>If <code>leancloud_counter_security</code> not specified (or commented), plugin will totally disabled.</p>
<h3 id="NexT-theme"><a href="#NexT-theme" class="headerlink" title="NexT theme"></a>NexT theme</h3><p>This plugin integrated in «NexT» and after plugin enabled in main Hexo config, need to enable options in NexT config:</p>
<pre><code class="yml"><span class="attr">leancloud_visitors:</span>
<span class="attr">  enable:</span> <span class="literal">true</span>
<span class="attr">  app_id:</span> <span class="string">&lt;&lt;your</span> <span class="string">app</span> <span class="string">id&gt;&gt;</span>
<span class="attr">  app_key:</span> <span class="string">&lt;&lt;your</span> <span class="string">app</span> <span class="string">key&gt;&gt;</span>
  <span class="comment"># Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</span>
<span class="attr">  security:</span> <span class="literal">true</span>
<span class="attr">  betterPerformance:</span> <span class="literal">false</span></code></pre>
<p><strong>Explaination for <code>betterPerformance</code>:</strong><br>Because the Leancloud developer’s plan has limits in requst thread amount and running time, counter number may be very slow to load in some times. If set <code>betterPerformance</code> to true, counter number will be displayed quickly by assuming the request is accepted normally.</p>
<p>You should build the Leancloud background first to make the counter active.</p>
<p>After that, install this plugin and config it to make the counter safe.</p>
<h3 id="Console-Command"><a href="#Console-Command" class="headerlink" title="Console Command"></a>Console Command</h3><pre><code>hexo lc-counter register &lt;&lt;username&gt;&gt; &lt;&lt;password&gt;&gt;</code></pre><p>or</p>
<pre><code>hexo lc-counter r &lt;&lt;username&gt;&gt; &lt;&lt;password&gt;&gt;</code></pre><p>Register a user in your Leancloud database for authority control.</p>
<h2 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h2><h3 id="fail-to-sync-records-to-the-leancloud-database"><a href="#fail-to-sync-records-to-the-leancloud-database" class="headerlink" title="fail to sync records to the leancloud database"></a>fail to sync records to the leancloud database</h3><p>For purpose of avoiding the 429 error code(Too Many Request) from leancloud, this plugin use a local database to store the records which have been successfully synchronized to the leancloud. Only the records that are not in the local database will be synchronized. This feature reduces the request quantity to avoid 429 error. The local databases is a json file named <code>leancloud.memo</code> in <code>&lt;&lt;blog directory&gt;&gt;/source</code>. Delete the <code>leancloud.memo</code> will not cause other flaws.  </p>
<p>If you failed to sync records to the leancloud and you are sure about the plugin causes the fault. You can delete the <code>leancloud.memo</code> and deploy again. The command is following.  </p>
<pre><code>rm &lt;&lt;blog directory&gt;&gt;/source/leancloud.memo
hexo d</code></pre>